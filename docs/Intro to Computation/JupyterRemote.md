---
layout: default
title: Setting Jupyter Notebook for PMACS HPC
has_children: false
parent: Intro to Computation
nav_order: 10
--- 

# Setting Up Jupyter Notebook for PMACS HPC

This guide will walk you through installing Jupyter Notebook locally, setting up a remote Jupyer server on a PMACS HPC worker node, and tunneling into it. This guide only walks through the process for setting it up for an interactive session.


This guide borrows from the HPC wiki guide [here](https://hpc.upenn.edu/wiki/index.php/HPC:Jupyter).

The initial setup for Jupyter is a little tricky, but once completed is easy to get up and running again.

## NOTE:
The following instructions are for Mac clients.
For Windows clients, the process is essentially the same. Refer to the [HPC wiki guide](https://hpc.upenn.edu/wiki/index.php/HPC:Jupyter) for more details. The only difference from the Wiki guide is loading the newer versions of Python and gcc, and removing the old versions, if any.



Once you login to <username>@consign.pmacs.upenn.edu, install the Jupyter client.

```[obki@consign ~]$ bsub -Is bash
<< Waiting for dispatch...>>
<<Starting on node157.hpc.local>>
[obki@node157 ~]$ module load python/3.11 gcc/12.2.0
[obki@node157 ~]$ pip3 install jupyter --user
```

Note: gcc/10.2.0 also works.


Now, we must make sure that our system path doesn't have the old version of gcc. 
If the output of ```module list``` includes an older gcc, like gcc/8.3.1, you can remove it by running ```module remove gcc/8.3.1```.

Run ```module list``` to check that you have python/3.11 and gcc/12.2.0 as first versions for both modules.


Run ```/appl/python-3.11/bin/jupyter notebook --ip node<nodenumber>``` to use the right Jupyter installation.


You should see output like the following:
```[I 16:13:48.696 NotebookApp] Serving notebooks from local directory: /home/obki
[I 16:13:48.696 NotebookApp] The Jupyter Notebook is running at:
[I 16:13:48.696 NotebookApp] http://node157.hpc.local:8888/?token=fbf40f23ca994ac5046337e6427ffea8d2be346fa54653ff
[I 16:13:48.696 NotebookApp]  or http://127.0.0.1:8888/?token=fbf40f23ca994ac5046337e6427ffea8d2be346fa54653ff
[I 16:13:48.697 NotebookApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
[W 16:13:48.707 NotebookApp] No web browser found: could not locate runnable browser.
[C 16:13:48.707 NotebookApp]


    To access the notebook, open this file in a browser:
        file:///home/obki/.local/share/jupyter/runtime/nbserver-19940-open.html
    Or copy and paste one of these URLs:
        http://node157.hpc.local:8888/?token=fbf40f23ca994ac5046337e6427ffea8d2be346fa54653ff
     or http://127.0.0.1:8888/?token=fbf40f23ca994ac5046337e6427ffea8d2be346fa54653ff
```
Next, we have to set up an SSH tunnel to connect to the webpage.

## Setup SSH Tunnel on macOS/Linux Clients

To setup an SSH tunnel to the Jupyter notebook session that was previously created, on a macOS or Linux client, use the following steps.

Step 1: Create a new Terminal (keep the previous one open). Create the tunnel using the following command:
```ssh -L 8888:node157:8888 <your_user_name>@consign.pmacs.upenn.edu```

NOTE 1: Since the remote interactive session was assigned to "node157" the above SSH forwarding command must be set to same node name. Change the node name as needed. Similarly, if you used a different port number, change the two `8888`'s to the port number listed in URL generated by the "jupyter notebook --ip `hostname`" command.

Step 2: Click the localhost specific link generated in the output of the "jupyter notebook --ip `hostname`" command (the link that starts with "http:// 127.0.0.1").

In the above example, that would be:
```http://127.0.0.1:8888/?token=fbf40f23ca994ac5046337e6427ffea8d2be346fa54653ff```

NOTE 2: The output of the "jupyter notebook --ip `hostname`" command produces a unique URL with a unique token. Ensure that you are clicking the link in your specific command output. DO NOT bookmark/save this link for future use.


